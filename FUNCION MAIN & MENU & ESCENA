#include <stdio.h>
#include <stdlib.h>
#define LONG 16

typedef struct
{
int espada;
int armadura; 
int escudo;
int dinero;
int pociones;
}Inventario;
typedef struct
	{
char nombre[LONG];
int atk;
int hp; 
int hpactual;
	}Personaje;
typedef struct
	{
char nombre[LONG];
int atkmons;
int hpmons;
int hpactualmons;
	}Enemigo;
typedef struct
	{
int pista1;
int pista2;
int pista3;
	}Pistas;
//FUNCION MENU
int menu (Personaje *pe, Inventario *inv)
{
	char decis;
	char sel;
	do
	{
	do
	{
	system("cls");
	printf("-1 Volver\n-2 Inventario\n-3 Salir del juego\n");
	scanf("%c",&sel);
	if(sel=='1')
	return 0;
	if(sel=='4')
	return 0;
	
	}
	while(sel!='2'&&sel!='3');
	if(sel=='2')
		{
	
	system("cls");
	printf("|Salud: %i / %i  Fuerza: %i|  Dinero: %i\n\n\n", (*pe).hpactual, (*pe).hp, (*pe).atk, (*inv).dinero);
		//ESPADAS
		printf("Espada: ");
		if((*inv).espada==0)
		printf("Ninguna\n");
		if((*inv).espada==1)
		printf("Espada rota\n");
		if((*inv).espada==2)
		printf("Espada de hierro\n");
		if((*inv).espada==4)
		printf("Espada bastarda\n");
		//ESCUDOS
		printf("\nEscudo: ");
		if((*inv).escudo==0)
		printf("Ninguno\n");
		if((*inv).escudo==1)
		printf("Broquel viejo\n");
		if((*inv).escudo==2)
		printf("Rodela\n");
		if((*inv).escudo==4)
		printf("Escudo de lagrima\n");
		//ARMADURAS
		printf("\nArmadura: ");
		if((*inv).armadura==0)
		printf("Ninguna\n");
		if((*inv).armadura==3)
		printf("Ropa acolchada\n");
		if((*inv).armadura==6)
		printf("Pechera de cuero\n");
		if((*inv).armadura==10)
		printf("Cota de malla\n");
		printf("\nPociones: %i",(*inv).pociones);
		printf("\n\n Quieres usar una pocion?\n-1: Si\n-2: No\n");
		do
		scanf("%c",&decis);
		while(decis!='1'&&decis!='2');
		if(decis=='1')
		{
			if((*inv).pociones!=0)
		   {
	       (*pe).hpactual=(*pe).hpactual+10;
	       (*inv).pociones--;
	       printf("Vida actual: %d \n",(*pe).hpactual);
	       }
	       else{
	       printf("No te quedan pociones\n");
	   		system("pause");
			   }
		}
	
		}
	if(sel=='3')
	return 1000;
	}while(sel!='1');
}	
//FUNCION ESCENA
int escena (Personaje *pe, Enemigo *mo,Inventario *inv, Pistas *pi, int situacion)
{
	int salidamenu;
	char decision;
if(situacion==251)
{
	printf("Abres los ojos, y lo primero que observas es la reinante oscuridad en tu entorno.\n\nPor mucho que lo intentas no recuerdas quien eres ni que haces en una cueva como esta\nQue haces?\n-1: Inspeccionar el terreno\n-2: Buscar una salida\n-3: MENU\n");
	do
	{
	scanf("%c",&decision);

	if(decision=='1')
		{
	printf("Observas que hay una peque√±a fuente de luz sobre tu cabeza, al levantarla ves como a mucha altura hay algo que parece ser una rotura del techo de piedra\nDeduces que has caido por ahi, al ver varios escombros a tu alrededor\n");
	(*pi).pista1=1;
		}	
	if(decision=='3')
	{
	return 5600;
	if(salidamenu==1000)
	return 1000;
	}
	}while(decision!='2');
}
if(situacion==252)
{
}
if(situacion==253)
{
}

	
}
	
	
int escena (Personaje *pe,Enemigo *mo, Inventario *inv, Pistas *pi,int situacion);
int combate (Personaje *pe, Enemigo *mo, Inventario *inv);
int menu (Personaje *pe, Inventario *inv);

int main(void)
{
Personaje pe;
Enemigo mo;
Inventario inv;
Pistas pi;
char menuinicio, menunum,rehacer,restart;
int muerte, salidaescena, esactual;
int esp1= 1001, esp2= 1002, esp3=1003;
int esc1=2001, esc2=2002, esc3=2003;
int arm1=3001, arm2=3002, arm3=3003;
int pocion=4000;
int i;
	
			do
			{
				system("cls");
				printf("MENU, ELIGE :\n 1-Empezar partida\n 2-Salir del juego\n");
				scanf("%c",&menuinicio);
				fflush(stdin);
			}while(menuinicio!='1'&&menuinicio!='2');
		if(menuinicio=='1')
		{
			printf("Bienvenido\n");
	do{
	//reinicio de inventario en caso de morir y volver a jugar
	if(restart='1')
	{
		inv.armadura=0;
		inv.escudo=0;
		inv.espada=0;
		inv.pociones=0;
		restart='0';
	}
	do{
		system("cls");
		//CREACION DE PERSONAJE
    		printf("Introduzca el nombre del personaje(15 caracteres maximo):\n");
    		fflush(stdin);
    		gets(pe.nombre);   
   			printf("Elige la clase de tu personaje: \n 1-Guardian\n 2-Barbaro\n 3-Caballero\n -El guardian ha sobrevivido multiples batallas, teniendo un cuerpo resistente\n-El barbaro aprovecha su fuerza natural para atacar a sus enemigos\n-El caballero ha entrenado en varias artes, siendo un personaje equilibrado\n\n");
    			do		
					scanf("%c",&menunum);
    			while(menunum!='1'&&menunum!='2'&&menunum!='3');
    				if(menunum=='1')
    				{	
    					pe.atk=6;
    					pe.hp=35;
    					pe.hpactual=35;
    					printf("Has elegido al Guardian\nAtaque: %i   Salud: %i\n",pe.atk,pe.hp);
					}
					else if(menunum=='2')
					{
						pe.atk=15;
    					pe.hp=20;
    					pe.hpactual=20;
    					printf("Has elegido al Barbaro\nAtaque: %i   Salud: %i\n",pe.atk,pe.hp);
					}
					else if(menunum=='3')
					{
						pe.atk=10;
    					pe.hp=27;
    					pe.hpactual=27;
    					printf("Has elegido al Caballero\nAtaque: %i   Salud: %i\n",pe.atk,pe.hp);
					}
		printf("Estas seguro?\n-1: Si, empezar partida\n-2: No, volver a la seleccion de personaje");
			do
				{
					scanf("%c",&rehacer);
					fflush(stdin);
				}
				while(rehacer!='1'&&rehacer!='2');
		}
		while(rehacer!='1');
		
		//LLAMADA A ESCENA
		if(rehacer=='1')
		do
		{	
			muerte=0;
			esactual=251;
			salidaescena=escena(&pe,&mo,&inv,&pi,esactual);
			if(salidaescena==5600)
			salidaescena=menu(&pe,&inv);
			//ESCENAS
			if(salidaescena==1000)
			{
			printf("Hasta la proxima!\n");
			system("pause");
			return 0;
			}
			if(salidaescena==252)
			esactual=252;
			if(salidaescena==253)
			esactual=253;
			if(salidaescena==254)
			{
				muerte=1;
				printf("Tras adentrarte en el camino a oscuras, te tropiezas y caes por un foso, muriendo por la caida\n\n");
			}
			
//-----------------------------------------------			
			
			//INVENTARIO
			if(salidaescena==esp1)
			inv.espada=1;
			if(salidaescena==esp2)
			inv.espada=2;
			if(salidaescena==esp3)
			inv.espada=4;
			if(salidaescena==esc1)
			inv.escudo=1;
			if(salidaescena==esc2)
			inv.escudo=2;
			if(salidaescena==esc3)
			inv.escudo=4;
			if(salidaescena==arm1)
			inv.armadura=3;
			if(salidaescena==arm2)
			inv.armadura=6;
			if(salidaescena==arm3)
			inv.armadura=10;
			if(salidaescena=pocion)
			inv.pociones++;
			if(1<=salidaescena<=250)
			for(i=1;i<=salidaescena;i++)
			inv.dinero++;
			
		}
		while(muerte==0);
if(muerte=1)
{
	printf("Quieres volver a intentarlo?\n-1 Si\n-2No, salir del juego\n");
	scanf("%c",&restart);
	fflush(stdin);
}

}
while(restart='1');
		}
		else if(menuinicio=='2')
		{
			printf("Hasta la proxima!\n");
			return 0;	
		}	
	
	
 
 
 
return 0;
}
	
